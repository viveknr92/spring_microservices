node {
    stage("clean workspace") {
        deleteDir()
    }
    stage("git checkout") {
        checkout scm
    }
    stage("mvn build") {
        echo "PATH = ${PATH}"
        dir("MovieInfoService") {
            sh "ls"
            sh "pwd"
            sh "mvn clean install -DskipTests"
        }
    }
    stage("docker build") {
        sh "echo 1992 | sudo -S -k docker build -t movieinfo ."
        sh "echo 1992 | sudo -S -k docker images"
        sh "echo 1992 | sudo -S -k docker ps"
    }
    stage("docker run") {
        sh "echo 1992 | sudo -S -k docker run -p 8081:8081 movieinfo ."
        sh "echo 1992 | sudo -S -k docker images"
        sh "echo 1992 | sudo -S -k docker ps"
    }
}